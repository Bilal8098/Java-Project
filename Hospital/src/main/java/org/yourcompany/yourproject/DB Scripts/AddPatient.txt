CREATE OR REPLACE PROCEDURE AddPatient(
patName VARCHAR2,
patpass VARCHAR2,
patAddress VARCHAR2,
patDepartment VARCHAR2,
patAge NUMBER,
patPhone VARCHAR2,
patEmail VARCHAR2
) 
IS
depid number;
BEGIN
SELECT DEPTID INTO DEPID
FROM DEPARTMENTS
WHERE DEPTNAME = patDepartment;
EXECUTE IMMEDIATE 'CREATE USER ' || patName || ' IDENTIFIED BY ' || patpass;
EXECUTE IMMEDIATE 'GRANT CONNECT TO ' || patName;
EXECUTE IMMEDIATE 'GRANT SELECT ON Appointment TO ' || patName;
EXECUTE IMMEDIATE 'GRANT SELECT ON Rooms TO ' || patName;
EXECUTE IMMEDIATE 'GRANT SELECT ON Bills TO ' || patName;


INSERT INTO HospitalUsers(UserName, UserAddress,
UserAge, UserPhone, UserEmail, UserRole)
VALUES (patName, patAddress,
patAge, patPhone, patEmail, 'PATIENT');

INSERT INTO Patient(PATIENTID, HISTORYDEPT)
VALUES(userseq.currval, depid);
END;

DECLARE
NAME VARCHAR2(20);
PASSW VARCHAR2(30);
ADDRESS VARCHAR2(50);
DEPT VARCHAR2(20);
AGE NUMBER;
PHONE VARCHAR2(20);
EMAIL VARCHAR2(30);
BEGIN
    AddPatient(NAME, PASSW, ADDRESS, DEPT, AGE, PHONE, EMAIL);
END;
